---
title: "Analyses_by_Ohlert"
author: "Tim Ohlert"
date: "2/2/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#load packages
```{r}
library(lmerTest)
library(tidyverse)
library(car)
library(visreg)
```


#load data
```{r}
df_annual <- read_csv("df_annual.csv")
df_merge <- read_csv("df_merge.csv")
df_site <- read_csv("df_site.csv")
NutNetPheno_long <- read_csv("NutNetPheno_long.csv")
```


#RE: analysis. Totally simplified (amazing!!!) A three part analysis:
## STEP 1, show that there has been a directional, temporal shift towards "greening" and earlier springs since ~1980


```{r}
mod <- lmer(ChangeSOS ~ #change in green-up date from long-term avg.
              site * gs + #site * growing season (year)
              (1 | gs),
              data = df_merge)

Anova(mod)

visreg(mod)
```




## STEP 2 go on a fishing expedition - does the *temporal* signature of phenology (e.g. the SLOPE of green-up date thru time) map onto any abiotic or biotic site-level characteristics?
### year, or growing season, is implicit within the slopes being analyzed - thus this is just a straight linear model

```{r}
mod <- lmer(PhenoTrendXyr_sos_slope ~ #slope of green-up date change thru time
              abs(latitude) + #absolute value of latitude (since southern hemi sites!)
              Elevation + #elevation
              RainMAP + #long-term mean annual precip
              TempMAT + #long-term mean annual temp
              ndep_2016 + #modeled nitrogen deposition
              Richness + #alpha diversity
              FractionExotic +  #percent exotic species
              # ObsYrMeanEven + #NAs in this variable; so removed
              # SoilC + SoilN + SoilP + #NAs in this variable; so removed
              (1 | continent),
              data = df_merge)

Anova(mod)
summary(mod)

visreg(mod)
```

## STEP 3, address interannual variability. Do phenological variations across years map onto annual weather patterns?
### hmm, currently there is singularity in these models, will fix eventually
```{r}
Anova(lmer(ChangeSOS ~ #change in green-up date from site long-term average
              anom_2moTemp_sos + #change in spring temp from site long-term average
              anom_2moPrecip_sos + #change in spring precip from site long-term average
              gs + #growing season (aka year)
              as.factor(gs) + #year as a categorical factor
              (1 | site / continent),
            data = (eachyr %>%
                     left_join(SiteInfo))))
```




















